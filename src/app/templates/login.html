{% extends 'base.html' %}

{% block title %}
Stats
{% endblock %}

{% block content %}
<style>
    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    .form-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    input {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
</style>
<div class="container">
    <form id="login-form">
        <div class="form-group">
            <label for="email">Username:</label>
            <input type="text" id="email" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" required>
        </div>
        <button type="submit" class="hacker-btn">Login</button>
    </form>
</div>
<script>
    const API_BASE_URL = "http://0.0.0.0:8000";  // замените на свой хост, если нужно

    document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    const formData = new URLSearchParams();
    formData.append("username", email);
    formData.append("password", password);
    formData.append("grant_type", "password");

    try {
        const response = await fetch(`${API_BASE_URL}/auth/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Accept': 'application/json'
            },
            credentials: 'include',
            body: formData
        });

        if (response.status === 204) {
            // Успешный вход, тело пустое
            window.location.href = "/";
            return;
        }

        if (!response.ok) {
            const error = await response.json();
            console.error("Ошибка логина:", error);
            alert("Ошибка входа: " + JSON.stringify(error.detail));
            return;
        }

        // Если сервер всё же прислал JSON (например, ошибка или токен)
        const data = await response.json();
        console.log("Ответ сервера:", data);

    } catch (err) {
        console.error("Ошибка запроса:", err);
        alert("Ошибка запроса: " + err.message);
    }
});

</script>

{% endblock %}